<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MotokoPilot</title>
<link rel="icon" href="motokopilot_logo.png" sizes="32x32" />
<link rel="apple-touch-icon" sizes="180x180" href="motokopilot_logo.png" />
<style>
body { margin:0; padding:0; font-family:'Inter',sans-serif; overflow:hidden; 
      background:linear-gradient(270deg,#6a11cb,#2575fc,#6a11cb,#2575fc); 
      background-size:200% 200%; animation:rainbow 20s ease infinite;}
@keyframes rainbow {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
#particle-canvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none; z-index:0;}
#chat-container {position:absolute; bottom:20px; left:50%; transform:translateX(-50%); width:90%; max-width:600px; max-height:75%; background:rgba(0,0,0,0.15); border-radius:20px; padding:15px; display:flex; flex-direction:column; overflow:hidden; backdrop-filter:blur(15px); box-shadow:0 0 25px rgba(0,255,234,0.2);}
#chat {flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px; perspective:1000px;}
.msg {padding:10px 14px; border-radius:15px; max-width:75%; position:relative; transform-style:preserve-3d; transition:transform 0.3s, box-shadow 0.3s; opacity:0; animation:fadeInUp 0.5s forwards; box-shadow:0 0 10px rgba(0,255,234,0.5);}
.user-msg {align-self:flex-end; background:#2575fc; color:#fff; border-bottom-right-radius:2px;}
.ai-msg {align-self:flex-start; background:rgba(0,255,234,0.1); color:#00ffea; border-bottom-left-radius:2px;}
.holo-card {background: rgba(0,255,234,0.1); border:1px solid rgba(0,255,234,0.5); padding:12px; margin:5px 0; border-radius:15px; box-shadow:0 0 15px rgba(0,255,234,0.7); transform-style:preserve-3d; transition: transform 0.3s;}
#input-bar {display:flex; margin-top:10px;}
#input {flex:1; padding:10px; border:none; border-radius:12px 0 0 12px; outline:none;}
#send {padding:0 20px; border:none; border-radius:0 0 12px 0; background:#00ffea; color:#000; cursor:pointer; transition:.2s;}
#send:hover{background:#00ccab;}
.mic-btn {padding:0 16px; border:none; border-radius:0 12px 12px 0; background:#4caf50; color:white; cursor:pointer; margin-left:4px; transition:.2s;}
.mic-btn:hover {background:#43a047;}
.hero {text-align:center; padding:40px 20px; color:white;}
.hero img {height:64px; margin-bottom:20px;}
.cta-button {background:white; color:#2575fc; padding:12px 24px; border-radius:8px; text-decoration:none; font-weight:bold; transition:0.2s;}
.cta-button:hover{background:#f0f0f0;}
@keyframes fadeInUp {0%{opacity:0; transform:translateY(10px);}100%{opacity:1; transform:translateY(0);}}
</style>
</head>
<body>

<canvas id="particle-canvas"></canvas>

<section class="hero">
  <img src="motokopilot_logo.png" alt="MotokoPilot Logo" />
  <h1>Welcome to MotokoPilot</h1>
  <p>Your AI companion for learning, productivity, and Ethereum insights.</p>
  <a href="#chat-container" class="cta-button">Start Chatting</a>
</section>

<div id="chat-container">
  <div id="chat"></div>
  <div id="input-bar">
    <input id="input" type="text" placeholder="Say something or enter ETH address..." />
    <button id="send">Send</button>
    <button id="mic" class="mic-btn">🎤 Talk</button>
  </div>
</div>

<script>
// Particle background
const canvas=document.getElementById('particle-canvas'); const ctx=canvas.getContext('2d'); canvas.width=window.innerWidth; canvas.height=window.innerHeight;
window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});
class Particle{constructor(x,y){this.x=x;this.y=y;this.size=Math.random()*2+1;this.speedX=(Math.random()-0.5)*0.5;this.speedY=(Math.random()-0.5)*0.5;this.opacity=Math.random()*0.5+0.3;} update(){this.x+=this.speedX;this.y+=this.speedY;} draw(){ctx.fillStyle=`rgba(0,255,234,${this.opacity})`;ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fill();}}
const particles=[];for(let i=0;i<200;i++)particles.push(new Particle(Math.random()*canvas.width,Math.random()*canvas.height));
function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animate);} animate();

// Chat helpers
const chat=document.getElementById('chat'), input=document.getElementById('input'), send=document.getElementById('send'), micBtn=document.getElementById('mic');
function addMessage(text,cls){const div=document.createElement('div');div.className=cls==='user'?'msg user-msg':'msg ai-msg';div.textContent=text;chat.appendChild(div);chat.scrollTop=chat.scrollHeight;return div;}
function addHoloCard(content){const card=document.createElement('div');card.className='holo-card';card.innerHTML=content;chat.appendChild(card);chat.scrollTop=chat.scrollHeight;}

// Voice recognition & speech
let recognition;if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){const SpeechRec=window.SpeechRecognition||window.webkitSpeechRecognition;recognition=new SpeechRec();recognition.continuous=false;recognition.lang='en-US';recognition.interimResults=false;recognition.onresult=function(e){input.value=e.results[0][0].transcript;sendMessage();}}
function speak(text){if(!window.speechSynthesis)return;const utter=new SpeechSynthesisUtterance(text);utter.rate=1;utter.pitch=1;window.speechSynthesis.speak(utter);}

// Send message
async function sendMessage(){
    const txt=input.value.trim(); if(!txt)return; addMessage(txt,'user'); input.value='';

    // Ethereum address handling
    const ethAddressRegex=/^0x[a-fA-F0-9]{40}$/;
    if(ethAddressRegex.test(txt)){
        addMessage('Fetching Ethereum info...','ai');
        try{
            const balRes=await fetch(`https://api.etherscan.io/api?module=account&action=balance&address=${txt}&tag=latest&apikey=YourApiKeyToken`);
            const balData=await balRes.json();
            const txRes=await fetch(`https://api.etherscan.io/api?module=account&action=txlist&address=${txt}&startblock=0&endblock=99999999&page=1&offset=5&sort=desc&apikey=YourApiKeyToken`);
            const txData=await txRes.json();
            const balanceMsg=`Balance: ${balData.result/1e18} ETH`; addHoloCard(`<strong>${balanceMsg}</strong>`); speak(balanceMsg);
            txData.result.forEach(tx=>{const txMsg=`Tx from ${tx.from.substring(0,10)} to ${tx.to.substring(0,10)} of ${tx.value/1e18} ETH`; addHoloCard(`<strong>${txMsg}</strong>`); speak(txMsg);});
        }catch(err){addMessage('⚠️ Failed to fetch Ethereum info','ai'); speak('Failed to fetch Ethereum info.'); console.error(err);}
        return;
    }

    // GPT-5 Mini / LLaMA API call
    const aiDiv = addMessage('AI is typing...','ai');
    try{
        const res = await fetch('http://llama-31-70b-instruct.nim-service:8000/v1/chat/completions', {
            method:'POST',
            headers:{'Accept':'application/json','Content-Type':'application/json'},
            body: JSON.stringify({
                model: "meta/llama-3.1-70b-instruct",
                messages: [{ role: "user", content: txt }],
                top_p:1, n:1, max_tokens:1024, stream:false, frequency_penalty:0.0, stop:["STOP"]
            })
        });
        if(!res.ok) throw new Error('Failed to fetch GPT');
        const data = await res.json();
        aiDiv.textContent='';
        const reply = data.choices[0].message.content;
        addHoloCard(reply);
        speak(reply);
    }catch(err){aiDiv.textContent='⚠️ Failed to connect to GPT'; console.error(err);}
}

send.addEventListener('click',sendMessage);
input.addEventListener('keypress', e=>{if(e.key==='Enter')sendMessage();});
micBtn.addEventListener('click', ()=>{if(!recognition){alert('Speech Recognition not supported');return;} recognition.start();});
</script>

</body>
</html>
